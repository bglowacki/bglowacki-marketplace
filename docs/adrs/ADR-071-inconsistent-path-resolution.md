# ADR-026: Inconsistent Project Path Resolution Between Scripts

## Status
PROPOSED

## Context
Two scripts use different algorithms for resolving project paths.

## Finding
**Files**:
- `collect_usage.py:787-811` - uses `endswith` fuzzy matching
- `generate_session_summary.py:33-38` - uses exact folder name construction

### generate_session_summary.py logic:
```python
folder_name = cwd.replace("/", "-").lstrip("-")
folder = base / f"-{folder_name}"  # Try with leading dash
if not folder.exists():
    folder = base / folder_name    # Fallback without dash
```

### collect_usage.py logic:
```python
if any(norm_cwd.endswith(suffix) for suffix in suffixes):
    return project_dir  # Fuzzy endswith match
```

## Impact
- Same project path might resolve differently between scripts
- Summaries generated by hook might not be found by collector
- Potential for false matches in collector with fuzzy matching

## Recommendation
Extract path resolution to a shared utility module:

```python
# shared/paths.py
def project_folder_name(cwd: str) -> str:
    """Convert cwd to Claude project folder name."""
    return cwd.replace("/", "-").lstrip("-")

def get_project_dir(base: Path, cwd: str) -> Path | None:
    """Get project directory, checking both dash-prefixed and non-prefixed."""
    folder_name = project_folder_name(cwd)
    for prefix in ["-", ""]:
        folder = base / f"{prefix}{folder_name}"
        if folder.exists():
            return folder
    return None
```

This ensures both scripts use identical logic.

## Review Notes
- Severity: Medium (integration risk)
- Effort: Medium (refactoring)
- Risk: Low (pure refactor)
